#!/usr/bin/python3

import argparse
import sys

from cougarnet.virtualnet import VirtualNetwork

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('--display',
            action='store_const', const=True, default=False,
            help='Display the network configuration as text')
    parser.add_argument('--output-file', '-o',
            type=argparse.FileType('w'), action='store',
            help='Print the network configuration to a file')
    parser.add_argument('config_file',
            type=argparse.FileType('r'), action='store',
            help='File containing the network configuration')
    args = parser.parse_args(sys.argv[1:])

    net = VirtualNetwork.from_file(args.config_file)
    if args.display:
        net.display(args.output_file)
    try:
        net.config()
        net.start()
        sys.stdout.write('Ctrl-c to quit\n')
        net.message_loop()
    except KeyboardInterrupt:
        pass
    finally:
        net.cleanup()

if __name__ == '__main__':
    main()
